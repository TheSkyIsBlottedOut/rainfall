#!/usr/bin/env zsh
#- Exports the zsh functions for logging.

__namedcolor() {
  local colorname="$1"
  case $colorname in
    black) print "30";;
    red) print "31";;
    green) print "32";;
    yellow) print "33";;
    blue) print "34";;
    magenta) print "35";;
    cyan) print "36";;
    white) print "37";;
    BLACK) print "40";;
    RED) print "41";;
    GREEN) print "42";;
    YELLOW) print "43";;
    BLUE) print "44";;
    MAGENTA) print "45";;
    CYAN) print "46";;
    WHITE) print "47";;
    *) print "37";;
  esac
}

__fgcolor() {
  local color= __namedcolor "$1"
  printf "\e[38;5;4%sm" $color
}

__bgcolor() {
  local color= __namedcolor "$1"
  printf "\e[48;5;%sm" $color
}

__resetcolor() {
  printf "\e[0m"
}

__emoji() {
  local emojiname="$1"
  case $emojiname in
    happy) print "ğŸ˜Š";;
    sad) print "ğŸ˜¢";;
    angry) print "ğŸ˜¡";;
    warning) print "âš ï¸";;
    robot) print "ğŸ¤–";;
    kitty) print "ğŸ±";;
    dog) print "ğŸ¶";;
    boom|explode) print "ğŸ’¥";;
    rofl|lol) print "ğŸ¤£";;
    alert) print "ğŸš¨";;
    check) print "âœ…";;
    x) print "âŒ";;
    question) print "â“";;
    exclamation) print "â—";;
    heart) print "â¤ï¸";;
    brokenheart) print "ğŸ’”";;
    star) print "â­";;
    star2) print "ğŸŒŸ";;
    star3) print "âœ¨";;
    star4) print "ğŸ’«";;
    star5) print "ğŸŒ ";;
    fingercross|crossed-fingers) print "ğŸ¤";;
    peace) print "âœŒï¸";;
    handshake) print "ğŸ¤";;
    thumbsup) print "ğŸ‘";;
    ok|okay) print "ğŸ‘Œ";;
    thumbsdown) print "ğŸ‘";;
    shrug) print "ğŸ¤·";;
    failure) print "ğŸš«";;
    recycle) print "â™»ï¸";;
    recycle2) print "ğŸ”";;
    horns|throw-horns) print "ğŸ¤˜";;
    point-left) print "ğŸ‘ˆ";;
    point-right) print "ğŸ‘‰";;
    arrow-left) print "â¬…ï¸";;
    arrow-right) print "â¡ï¸";;
    arrow-up) print "â¬†ï¸";;
    arrow-down) print "â¬‡ï¸";;
    chart-up) print "ğŸ“ˆ";;
    chart-down) print "ğŸ“‰";;
    money) print "ğŸ’°";;
    moneybag) print "ğŸ’°";;
    money-flying) print "ğŸ’¸";;
    money-wings) print "ğŸ’¸";;
    call|phone) print "ğŸ“";;
    mail|email) print "ğŸ“§";;
    mail2|email2) print "ğŸ“¨";;
    mail3|email3) print "ğŸ“©";;
    connect) print "ğŸ”—";;
    disconnect) print "ğŸ”—";;
    lock) print "ğŸ”’";;
    unlock) print "ğŸ”“";;
    key) print "ğŸ”‘";;
    key2) print "ğŸ—ï¸";;
    lock2) print "ğŸ”";;
    unlock2) print "ğŸ”“";;
    anger|angry|angery) print "ğŸ˜¡";;
    100%|100) print "ğŸ’¯";;
    kiss|lipstick) print "ğŸ’‹";;
    sweatdrops) print "ğŸ’¦";;
    sweat) print "ğŸ˜“";;
    sweatlaugh) print "ğŸ˜…";;
    sweatcry) print "ğŸ˜°";;
    sweatfrown) print "ğŸ˜¥";;
    sleeping|zzz) print "ğŸ’¤";;
    sleepy|sleepyhead) print "ğŸ˜ª";;
    halt|stop) print "ğŸ›‘";;
    handprint) print "ğŸ–ï¸";;
    powerfist|fist) print "âœŠ";;
    fistbump) print "ğŸ‘Š";;
    fistbump-left) print "ğŸ¤œ";;
    fistbump-right) print "ğŸ¤›";;
    clap|clapping) print "ğŸ‘";;
    pray|praying) print "ğŸ™";;
    highfive) print "ğŸ™Œ";;
    wave|waving) print "ğŸ‘‹";;
    rocket) print "ğŸš€";;
    fire|fiyah) print "ğŸ”¥";;
    bomb) print "ğŸ’£";;
    umbrella) print "â˜‚ï¸";;
    danger) print "â˜ ï¸";;
    radioactive) print "â˜¢ï¸";;
    biohazard) print "â˜£ï¸";;
    skull) print "ğŸ’€";;
    nuclear) print "âš›ï¸";;
    atom) print "âš›ï¸";;
    usa|america) print "ğŸ‡ºğŸ‡¸";;
    genie) print "ğŸ§";;
    wizard) print "ğŸ§™";;
    witch) print "ğŸ§™â€â™€ï¸";;
    wheelchair|handicap) print "ğŸ§‘â€ğŸ¦½";;
    running|run-away) print "ğŸƒ";;
    climbing|climb) print "ğŸ§—";;
    swim|swimming) print "ğŸŠ";;
    cloud) print "â˜ï¸";;
    sun) print "â˜€ï¸";;
    rain) print "ğŸŒ§ï¸";;
    moon) print "ğŸŒ™";;
    storm) print "ğŸŒ©ï¸";;
    thunder|lightning) print "âš¡";;
    snow) print "â„ï¸";;
    snowflake) print "â„ï¸";;
    snowman) print "â˜ƒï¸";;
    tornado) print "ğŸŒªï¸";;
    hurricane) print "ğŸŒ€";;
    map) print "ğŸ—ºï¸";;
    compass) print "ğŸ§­";;
    globe) print "ğŸŒ";;
    clock) print "â°";;
    hourglass) print "âŒ›";;
    calendar) print "ğŸ“…";;
    alarm) print "ğŸš¨";;
    surf|surfing) print "ğŸ„";;
    ski|skiing) print "â›·ï¸";;
    wave|tidal-wave|tsunami) print "ğŸŒŠ";;
    volcano) print "ğŸŒ‹";;
    mountain) print "â›°ï¸";;
    lovers) print "ğŸ’‘";;
    family) print "ğŸ‘ª";;
    baby) print "ğŸ‘¶";;
    love) print "ğŸ’•";;
    lots-of-love) print "ğŸ’";;
    clubs) print "â™£ï¸";;
    diamonds) print "â™¦ï¸";;
    spades) print "â™ ï¸";;
    hearts) print "â™¥ï¸";;
    crown) print "ğŸ‘‘";;
    gorilla) print "ğŸ¦";;
    elephant) print "ğŸ˜";;
    tiger) print "ğŸ…";;
    shark) print "ğŸ¦ˆ";;
    whale) print "ğŸ‹";;
    dolphin) print "ğŸ¬";;
    octopus) print "ğŸ™";;
    squid) print "ğŸ¦‘";;
    snail) print "ğŸŒ";;
    butterfly) print "ğŸ¦‹";;
    bee) print "ğŸ";;
    ant) print "ğŸœ";;
    ladybug) print "ğŸ";;
    spider) print "ğŸ•·ï¸";;
    scorpion) print "ğŸ¦‚";;
    crab) print "ğŸ¦€";;
    lobster) print "ğŸ¦";;
    shrimp) print "ğŸ¦";;
    fish) print "ğŸŸ";;
    whale) print "ğŸ‹";;
    dolphin) print "ğŸ¬";;
    *) print "ğŸ’¬â“";;
  esac
}


__nosh_log() {
  # __nosh_log info 'user.did.thing'
  # __nosh_log error 'user.did.thing'
  local Level="$1"
  local Color="gray"
  case $Level in
    info) Color="blue";;
    error|fatal) Color="red";;
    warn|warning) Color="yellow";;
    chatty|debug|success) Color="green";;
    crit|critical) Color="magenta";;
    fatal) Color="red";;
    comment) Color="gray";;
    notice|message) Color="cyan";;
    bright|highlight) Color="white";;
    *) Color="gray";;
  esac
  // find all :emoji: in the message and replace them with the actual emoji
  local Message="$2"
  grep -o -E ':[a-zA-Z0-9_-]+:' <<< $Message | while read -r match; do
    local emoji=$(echo $match | sed 's/://g')
    local replacement=$(__emoji $emoji)
    Message=$(echo $Message | sed "s/$match/$replacement/g")
  done
  print "$(__fgcolor white)[$(__fgcolor $Color)$Level$(__fgcolor white)] $(__emoji $Level) - $Message$(__resetcolor)\n"
  return 0
}

__nosh_spinner() {
  # shows fractions of a string in a spinner until a process is complete.
  # uses while loop to show spinner until the process is complete.
  # __nosh_spinner 'loading-message' 'command'
  local Message="$1"
  local Command="$2"
  local SpinnerChars="â ‹â ™â ¹â ¸â ¼â ´â ¦â §â ‡â "
  local SpinnerCharsLength=${#SpinnerChars}
  local SpinnerIndex=0
  local SpinnerChar=""
  local SpinnerMessage=""
  local SpinnerPID=""
  local SpinnerStatus=""

  while true; do
    SpinnerChar="${SpinnerChars:$SpinnerIndex:1}"
    SpinnerMessage="$(__fgcolor white)[$(__fgcolor blue)loading$(__fgcolor white)] $Message$(__fgcolor white) $SpinnerChar"
    print -n $SpinnerMessage
    eval $Command &
    SpinnerPID=$!
    while kill -0 $SpinnerPID 2>/dev/null; do
      sleep 0.1
      SpinnerIndex=$(( (SpinnerIndex + 1) % SpinnerCharsLength ))
      print -n "\b"
      print -n "${SpinnerChars:$SpinnerIndex:1}"
    done
    wait $SpinnerPID
    SpinnerStatus=$?
    if [[ $SpinnerStatus -eq 0 ]]; then
      print -n "\b"
      print -n "$(__fgcolor green)âœ…"
      puts
      return 0
    else
      print -n "\b"
      print -n "$(__fgcolor red)âŒ"
      puts
      return 1
    fi
  done
}

__nosh_log_to_file() {
    # logs to logs/nosh log file
    # __nosh_log_to_file 'info' 'user.did.thing' "any other" "messages"
    local Level="$1"
    local Event="$2"
    local Message="$@:3"
    local Timestamp=$(date "+%Y-%m-%d %H:%M:%S")
    local LogMessage="($Timestamp) [$Level] $Event: $Message"
    print -r $LogMessage >> $NOSH__LOG_FILE
    return 0
}

__log() {
  # logs to file and console
  # __log 'info' 'user.did.thing' "any other" "messages"
  local Level="$1"
  local Event="$2"
  local Message="$@:3"
  __nosh_log $Level $Event
  __nosh_log_to_file $Level $Event "$Message"
  return 0
}


#export -f __nosh_log
#export -f __nosh_spinner
#export -f __nosh_log_to_file
#export -f __emoji
#export -f __fgcolor
#export -f __bgcolor
#export -f __resetcolor
#export -f __log